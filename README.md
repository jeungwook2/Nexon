# Nexon 이벤트 시스템 프로젝트

안녕하세요 김정욱 입니다.  
일단 저에게 이런 기회를 주신 것에 너무 감사드립니다.


## 프로젝트 개요

제가 개발한 이벤트는 7일 출석 이벤트 입니다.  
보상은 1일, 2일, 3일, 4일, 5일, 6일, 7일 모두 개별로 지급되도록 설계했습니다.  
민감한 정보는 .env 파일을 활용하여 최대한 많이 숨기도록 설계했습니다.
번거로운 작업을 최소화 하기 위해서 .evn 파일은 강제로 푸쉬하여 진행하였습니다.

하지만 검증할 때 이벤트 시작일과 실제 시간을 기준으로 검증을 시도하고 있습니다.  
그래서 현재 날짜 기준으로는 보상 요청을 1번만 실행 가능하니 참고 부탁드립니다.

추가로 변경하여 테스트하신다면  
event 파일 아래 src 아래 action 아래 action.service.ts에 create 메서드 내부를 확인해주세요.

---
## 파일 다운로드
- 파일 zip 형태로 다운로드를 진행해 주세요.
- 파일 다운되면 압축을 풀고 vscode에서 (node 설치기준)압축을 푼 파일 최상단으로 이동해주세요.

## 개발 환경 및 실행 방법
- Docker 설치 / VSCode / Node.js 설치되어있다는 가정하에
- 최상단 파일 루트에서 yml 파일 실행  
  (VSCode, CMD, 터미널 모두 가능하나 상단 루트 확인해주세요)
  
명령어 : docker compose up --build 

POSTMAN 설치 !!  JSON 형태 요청 방식으로 API 테스트가 가능합니다.

포스트맨 실행해 주시면 감사합니다 :)
---
JSON 형태 API 요청 방식
---
초기 세팅하기 (관리자 계정 등록, 이벤트 코드 생성)
- 요청 방식 : Get
- 요청 URL : http://localhost:3000/setting
- 결과 : 아래 관리자 로그인용 데이터를 미리셋팅하여 테스트하실 때 불편함을 덜고자 구현했습니다.
- 2번 실행 시 이미 데이터를 예외 처리 해두었기 때문에 중복을 방지했습니다.
---
### 로그인 (관리자)
- 요청방식 : Post
- 요청 URL : http://localhost:3000/admin/login

- {
  "email": "admin",
  "pwd": "1234"
}
또는 
{
  "email":"operator",
  "pwd": "1234"
}
또는
{
  "email": "auditor",
  "pwd": "1234"
}

- 결과 : 토큰 발행하도록 설계했습니다. (발행 시간 1시간)
- 토큰 결과를 “” 제외하고 복사하여 다음 나오는 모든 API 요청에 추가하시면 됩니다.!
---
## 추가하시는법 : PostMan 실행후 url입력공간 바로밑에 Headers(헤더) 있습니다.

Key:value = 
Authorization:Bearer 토큰값  
*형식으로 추가해주시면  토큰 검증및 모든 기능 정상작동 가능합니다.
---

### 유저 등록하기
- 요청방식 : Post
- 요청 URL : http://localhost:3000/user/insert
- {
  "email" : "user01@nexon.com",
  "pwd" : "1234",
  "nick" : "wook2"
}
- 결과 : JSON message 로 성공여부 나올 수 있도록 설계했습니다.
- Pwd : 같은경우는 암호화 하여 노출을 방지했습니다 SHA-256 방식
---
### 이벤트 목록조회
- 요청방식 : Get
- 요청 URL : http://localhost:3000/events/list
- 결과 : 처음에는 빈배열 출력되시는걸 확인하실 수 있습니다.
---
### 이벤트 생성하기(관리자)
- 요청방식 : Post
- 요청 URL : http://localhost:3000/events
- {
  "title": "가정의 달 7 일 출석이벤트",
  "conditionCode": "INVITE",
  "conditionParams": {
    "inviteCount": 7
  },
  "steps": [
    {
      "day": 1,
      "reward": [
        { "name": "500 메이플 포인트", "count": 1 }
      ]
    },
    {
      "day": 2,
      "reward": [
        { "name": "경험치 2배 쿠폰 (15분)", "count": 1 }
      ]
    },
    {
      "day": 3,
      "reward": [
        { "name": "정령의 펜던트 (1일)", "count": 1 }
      ]
    },
    {
      "day": 4,
      "reward": [
        { "name": "메가 버닝 부스터", "count": 1 }
      ]
    },
    {
      "day": 5,
      "reward": [
        { "name": "황금 마일리지 티켓", "count": 1 }
      ]
    },
    {
      "day": 6,
      "reward": [
        { "name": "스페셜 명예의 훈장", "count": 1 }
      ]
    },
    {
      "day": 7,
      "reward": [
        { "name": "카오스 서큘레이터", "count": 1 }
      ]
    }
  ],
  "startAt": "2025-05-18T18:00:00+09:00",
  "endAt": "2025-05-24T23:00:00+09:00"
}

- 결과: 이벤트 등록되신 걸 확인 하실 수 있습니다.
내부 결과를 보시면 구조를, 날짜를 담은 객체 안에 보상 객체 안에 배열들로 구성했는데 이는 확장성을 고려하여 보상의 추가, 보상 날짜의 추가 등을 고려하여 구조화하였습니다. 이벤트는 이름을 기준으로 unique 하게 동작하기 때문인 것 같은 이름의 이벤트는 활성화 상태에 따라 등록할 수 있도록 설계했습니다.
다음 목록 조회를 재실행하시면 간략화된 정보를 출력하도록 설계했습니다.
목록 조회하게 되시면 id 값이 나오는데 그대로 이어서 상세 조회 진행해 주시면 감사합니다 :) 
---
### 이벤트 상세조회
- 요청방식 : Get
- 요청 URL : http://localhost:3000/events/list/목록조회에서 확인한 _id값

- 결과 : 이벤트의 등록되었던 모든 내용 (보상정보 포함)
---

## 유저의 보상요청 및 성공 여부
- 유저 계정으로 로그인 먼저 진행해서 토큰 발행 먼저 해주시면 됩니다.!!!
- admin 계정으로도 가능하나 토큰값 아이디 추출 부분에서 user가 형식적으로 맞다고 생각하기 때문에 번거로우시더라도 부탁드립니다!

### 로그인 (회원)
- 요청방식 : Post
- 요청 URL : http://localhost:3000/user/login

- {
  "email": "user01@nexon.com",
  "pwd": "1234"
}

- 결과 : 토큰값 생성 (role:user) 용
- 동일하게 토큰값을 헤더에 담아주신다음 진행해주세요 ! .
---
### 출석체크 요청 및 보상지급 요청보내기(user)
- 요청방식 : Post
- 요청 URL : http://localhost:3000/events/attendance
- {
  "eventTitle": "가정의 달 7 일 출석이벤트"
  }
- 결과 : 이벤트 이름을 가지고 참여를 신청하게 됩니다. 
- (EX: 이벤트 홈페이지의 1일 ~ 7일 까지 표가 있고 보상마다 밑에 버튼이 존재한다고 생각하고 구현했습니다.)
- 출석 체크 요청을 보내게 되면 검증하고 요청을 수락하게 되는데 처음 실행 시 보상 지급이 정상적으로 실행됩니다 .
- 그러다 중복으로 실행하게 되면 날짜 또한 기록되지 않으며 예외처리  "err": "이미 참여한 이벤트입니다 / 보상을 이미 받으셨습니다." 가 출력되도록 설계했습니다.
---
### 로그인 유저 출석체크 확인 및 / 요청정보 확인
- Ex : 
success : true : 요청 성공 + 보상지급 된내역
success : false : 요청 실패 + 지급되지 않은 보상내역

- checkedDates[]  -> 유저가 출석한 날짜 한국 시간으로 변경하여 자정 00:00 을 기준으로 날짜를 만들어서 기입했습니다.
- 보상에 지급 기준이 되는 day 값을 맞춰주기 위해서 이벤트 시작일자(한국) - 현재일(한국)+1 로 설정하여 값을 대입했습니다.
---
### 로그인 유저 기준 요청 조회 (토큰여부 꼭 확인해주세요)
- 요청방식 : Get 
- 요청 URL : http://localhost:3000/events/user
- {
  "eventTitle": "가정의 달 7 일 출석이벤트"
}

- 결과: 해당 요청에 유저의 출석을 담당한 컬렉션과 유저의 요청을 가지고있는 컬렉션을 출력하도록 설계했습니다.
- 출석체크를 2번 요청을 보내서 예외처리가 되었다면 아래 "success": "ture" 가 false 로 처리되어 요청실패 기록으로 저장되어있는걸 확인하실 수 있습니다.
---
### 관리자 계정 기준(토큰여부 꼭 확인해주세요 관리자 로그인 진행주셔야합니다.)
- 요청방식 : Get 
- 요청 URL : http://localhost:3000/events/admin
- {
  "eventTitle": "가정의 달 7 일 출석이벤트"
}
- 결과 : 모든 유저의 요청을 조회 할 수 있도록 설계했습니다. / 출석체크 또한 동일하게 출력되도록 설계했습니다.
---


### 보상 추가하기 (관리자 토큰값)
- 요청방식 : Post
- 요청 URL : http://localhost:3000/events/reward/add
- {
    "title":"가정의 달 7 일 출석이벤트",
    "name":"메가버닝 부스터",
    "count":1,
    "day":1
}
- 이벤트 목록 조회 후 상세 조회에서 확인하시면 보상 일차 day 값에 해당 내용의 객체가 배열 안에 추가된 것을 확인하실 수 있습니다.
---

### 도커파일 전부 내리고 삭제하기
- yml 파일 실행 취소 및 삭제 (최상단파일)
docker compose down -v
---

### 이상으로 긴 테스트 같이 함께해주셔서 너무 감사합니다.
### 저에게는 이런 기회가 저를 성장시킬 수 있도록 길을 열어주신 거 같아 다시 한번 감사 인사드립니다.  :) 

